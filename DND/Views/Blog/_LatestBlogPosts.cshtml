@model IList<DND.Core.DTOs.BlogPostDTO>

<div class="row">
    <div class="offset-1 col-10">
        <div class="card-deck">
            @foreach (var post in Model)
            {
                <div class="card margin-bottom-10" style="max-width:550px">
                    @{
                        bool isVideo = false;
                        bool isImage = false;
                        bool isText = false;
                        var mainPhoto = Server.GetDirectoryInfo(Server.GetFolderPhysicalPathById(Folders.Gallery) + post.Album).MainPhotoOrVideoOrText();
                        if (mainPhoto != null)
                        {
                            isVideo = mainPhoto.IsVideo();
                            isImage = mainPhoto.IsImage();
                            isText = mainPhoto.IsText();
                        }
                    }

                    @if (isVideo)
                    {
                        <video class="full-width-height" src="@mainPhoto.VirtualPathSlug()" poster="@mainPhoto.VirtualPathSlug(640,400)" controls preload="none"></video>
                    }
                    else if (isImage)
                    {
                        <a title="@post.Title" href="@(Url.Action<BlogController>(c => c.Post(post.DateCreated.Year, post.DateCreated.Month, post.UrlSlug)))">
                            <img class="card-img-top" src="@mainPhoto.VirtualPathSlug(640,400)" alt="@post.Title">
                        </a>
                    }
                    else if (isText)
                    {
                        var url = mainPhoto.ReadFileLine(0);
                        var poster = mainPhoto.ReadFileLine(1);
                        if (url.ToLower().Contains("mp4"))
                        {
                            <video class="full-width-height" src="@url" @if (!string.IsNullOrEmpty(poster)) { <text> poster="@poster" preload="none" </text> } else { <text> preload="metadata" </text> } controls></video>
                        }
                        else if (url.ToLower().Contains("you"))
                        {
                            <div>
                                <div class="youtube-container">
                                    <iframe src="@url" frameborder="0" allowfullscreen></iframe>
                                </div>
                            </div>
                        }
                        else
                        {
                            <a title="@post.Title" href="@(Url.Action<BlogController>(c => c.Post(post.DateCreated.Year, post.DateCreated.Month, post.UrlSlug)))">
                                <img class="card-img-top" src="@url" alt="@post.Title">
                            </a>
                        }
                    }

                    <div class="card-block">
                        <a href="@(Url.Action<BlogController>(c => c.Post(post.DateCreated.Year, post.DateCreated.Month, post.UrlSlug)))" title="@post.Title">
                            <h4 class="card-title">@post.Title</h4>
                        </a>
                        <p class="card-text">@post.ShortDescription.Truncate(150)</p>

                    </div>

                </div>
                        }
        </div>
    </div>
</div>